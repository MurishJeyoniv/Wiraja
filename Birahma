--=== [ JOPY STORE ] ===--

worldss = {}
waktu = {}
ffossil = {}
start_fossil = 1 -- gk usah diganti
checknya = false
t = os.time()
totalfossil = 0

startbot = 1

for index, botname in pairs(getAllBot()) do
   if botname:getLocal().name:upper() == getBot():getLocal().name:upper() then
      searchName = index + ( startbot - 1 )
      break
   end
end

worlds = BotList[searchName].worlds
startFrom = BotList[searchName].startFrom
DoorID = BotList[searchName].DoorID
UseWebhookStatus = BotList[searchName].UseWebhookStatus
WhStatus = BotList[searchName].WhStatus
MessageID = BotList[searchName].MessageID

start = startFrom
stop = #worlds

for i = start,#worlds do
    table.insert(worldss,worlds[i])
end

function mf(xy)
    return math.floor(xy / 32)
end

function place(id,x,y)
   getBot():placeTile(mf(getBot():getLocal().pos.x) + x,mf(getBot():getLocal().pos.y) + y,id)
end

function punch(x,y)
    getBot():hitTile(mf(getBot():getLocal().pos.x) + x,mf(getBot():getLocal().pos.y) + y)
end

function wear(id)
packet = {}
packet.type = 10 
packet.int_data = id
getBot():sendPacketRaw(packet)
end

nuked = false
steal = false

function warp(world, id)
    local rok = 0
    local cak = 0
    
    while true do
        local botStatus = getBot():getBotStatus()
        if botStatus == Success then
            local tile = getBot():getTile(math.floor(getBot():getLocal().pos.x / 32), math.floor(getBot():getLocal().pos.y / 32))
            
            if tile.fg == 6 then
                if cak == 10 then
                    steal = true
                    cak = 0
                    return
                end
                
                getBot():sendPacket("action|join_request\nname|" .. world .. "|" .. id .. "\ninvitedWorld|0", 3)
                sleep(5000)
                cak = cak + 1
            elseif tile.fg ~= 6 then
                if rok == 10 then
                    nuked = true
                    rok = 0
                    return
                end
                
                if getBot():getWorld().name:upper() ~= world:upper() then
                    getBot():sendPacket("action|join_request\nname|" .. world .. "\ninvitedWorld|0", 3)
                    sleep(5000)
                else
                 return
                end
                
                rok = rok + 1
            end
        end
        sleep(1000)
    end
end


function waktuWorld()
    strWaktu = ""
        for _,world in pairs(worlds) do
strWaktu = strWaktu .."\n" .. world:upper()  .. " ( " .. ("<:Fossil:1135233556138958949> : " .. (waktu[world] or "?")) .. " )"
    end
return strWaktu
end

   function Fossil()
   local fossil = 0
    for _,tile in ipairs(getBot():getTiles()) do
        if tile.fg == 3918 then
            fossil = fossil + 1
        end
    end
    return fossil 
end

function cekbuyer(nameowner)
  local RequestINFO = {}
  RequestINFO.url = "https://rentry.org/Orangmahsabar/raw"

  -- Mengambil teks dari URL
  local x = httpReq(RequestINFO)
  local response = x.body
  
  -- Memisahkan teks menjadi baris-baris
  local lines = {}
  for line in response:gmatch("[^\r\n]+") do
    table.insert(lines, line)
  end
  
  -- Mencari UserID berdasarkan nama owner
  for _, line in ipairs(lines) do
    local owner, userid = line:match("(%S+)%s+(%d+)")
    if owner == nameowner then
      return userid -- Mengembalikan UserID
    end
  end
  
  return nil -- Jika nama owner tidak ditemukan
end

function status()
    if getBot():getBotStatus() == Success then
      return string.upper("Online")
    elseif getBot():getBotStatus() == OnSendToServer then
      return string.upper("OnSendToServer")
    elseif getBot():getBotStatus() == Disconnected then
      return string.upper("Offline")
    elseif getBot():getBotStatus() == Banned then
      return string.upper("Banned")  
    elseif getBot():getBotStatus() == Suspended then
      return string.upper("Suspended")
    elseif getBot():getBotStatus() == Maintenance then
      return string.upper("Maintenance")
    elseif getBot():getBotStatus() == Connected then
      return string.upper("Coming Online")     
    elseif getBot():getBotStatus() == SERVER_OVERLOADED then
      return string.upper("Login Failed ( Overload )")
    elseif getBot():getBotStatus() == LogonATTEMPTS then
      return string.upper("Too Many Login Attempts")
    elseif getBot():getBotStatus() == Captcha then
      return string.upper("Solving Captcha")   
    elseif getBot():getBotStatus() == InvalidEmail then
      return string.upper("Invalid Email") 
    elseif getBot():getBotStatus() == Update_Required then
      return string.upper("Update Required") 
    elseif getBot():getBotStatus() == BypassTutorial then
      return string.upper("Finishing Tutorial")          
      else
      return string.upper("Unknown Status")
    end
end

function nungguverify()
if not checknya then
return " Waiting To Verify!"
else
return " Verified!"
end
end

function ceknya()
  local RequestINFO = {}
  RequestINFO.url = "https://rentry.org/orangmahsabar/raw"

  -- Mengambil teks dari URL
  local x = httpReq(RequestINFO)
  local response = x.body
  
  -- Menghitung jumlah baris
  local lineCount = 0
  for _ in response:gmatch("[^\r\n]+") do
    lineCount = lineCount + 1
  end
  
  return lineCount
end


function round(n)
    return n % 1 > 0.5 and math.ceil(n) or math.floor(n)
end

function CekTilePack(x,y,num)
    local count = 0
    local stack = 0
    for _,obj in pairs(getBot():getObjects()) do
        if round(obj.pos.x / 32) == x and math.floor(obj.pos.y / 32) == y then
            count = count + obj.count
            stack = stack + 1
        end
    end
    if stack < 20 and count <= (4000 - num) then
        return true
    end
    return false
end

function reconnect()
if getBot():getBotStatus() ~= Success then
repeat
getBot():reConnect()
sleep(8000)
until getBot():getBotStatus() == Success
end
if getBot():getBotStatus() == Success then
return
end
end

packitemid = {4134, 3936}

function SaveFossil()
if AutoSaveToOtherWorld then
if getBot():getItemCount(4134) > 0 or getBot():getItemCount(3936) > 0 then
botshow("Saving Fossil")
warp(WorldSave,WorldSaveID)
for _,pack in pairs(packitemid) do
        for _,tile in ipairs(getBot():getTiles()) do
            if tile.fg == PatokanID or tile.bg == PatokanID then
                if CekTilePack(tile.x,tile.y,getBot():getItemCount(pack)) then
                    while math.floor(getBot():getLocal().pos.x / 32) ~= (tile.x - 1) or math.floor(getBot():getLocal().pos.y / 32) ~= tile.y do
                        getBot():findPath(tile.x - 1,tile.y)
                        sleep(100)
                        reconnect()
                    end
                    while getBot():getItemCount(pack) > 0 and CekTilePack(tile.x,tile.y,getBot():getItemCount(pack)) do
                        getBot():sendPacket("action|drop\n|itemID|"..pack,2)
                        sleep(1000)
                        getBot():sendPacket("action|dialog_return\ndialog_name|drop_item\nitemID|"..pack.."|\ncount|"..getBot():getItemCount(pack),2)
                        sleep(1000)
                        reconnect()
                    end
                end
            end
            if getBot():getItemCount(pack) == 0 then
            reconnect()
                break
            end
        end
    end
end
end
end



function NextWorld()
  ::ANJAY::
    startFrom=startFrom+1
    start_fossil = 1
  start = start + 1
    if startFrom>#worlds then
        getBot():remove()
    end
    sleep(1000)
    warp(worlds[startFrom], DoorID)
    sleep(1000)
    if nuked then  
waktu[worldss[startFrom]] = "NUKED"
botshow("Nuked")
   nuked = false
  goto ANJAY
  end
end

function extracted(varlist)
    if varlist[0]:find("OnTalkBubble") and varlist[2]:find("I unearthed a Fossil!") then
        find_extracted = false
        fossil_rock = true
    end
end

getBot():addHook(extracted,varlist)


function scanFossil()
    m=0
    for _,tile in ipairs(getBot():getTiles())do
        if tile.fg==3918 then
            m=m+1
        end
    end
    m=math.floor(m)
    return m
end


function botshow(Info)
if not UseWebhookStatus then
return
end
te = os.time() - t
 local verify = "<a:cham:849841924734976000> **Status Verify: "..nungguverify().."**"
local activity = "**<:Pickaxe:1109395511661830176> Activity: "..Info.."**"
local namebot = "**<:bot:1049606018008612874> Name: "..getBot():getLocal().name:upper().." ( "..getBot():getLocal().level.." )**"
local world = "**<:World:1006699847308546109> World:** ||**"..getBot():getWorld().name:upper().."**||"
local statusbot = "**<a:Online:1063444758783078480> Status: "..status().."**"
local ping = "**<:Ping:1136942362103402566> Ping: "..getBot():getMs().." Ms**"
local fossilinfo = "**<:fossilrock:1064165167992156240> Fossil: "..Fossil().."**"
local uptime = "**<:pro_timeout:1100160755287982150>  Up Time**\n**"..math.floor(te/86400).." Days "..math.floor(te%86400/3600).." Hours "..math.floor(te%86400%3600/60).." Minutes "..math.floor(te%86400%3600%60).." Seconds**"

local deskripsi = verify .. "\n\n" .. activity .. "\n" .. namebot .. "\n" .. world .. "\n" .. statusbot .. "\n" .. ping .. "\n" .. fossilinfo .. "\n" ..waktuWorld().. "\n\n" ..uptime

    RequestINFO = {}
    RequestINFO.url = WhStatus.."/messages/"..MessageID
    RequestINFO.json = true
    RequestINFO.method = PATCH
    RequestINFO.postData =
        [[
        {
            "content": "Script Running",
            "embeds": [
                {
                    "title": "Jopy Rotation ( Total Buyer: ]]..ceknya()..[[ )",
                    "description": "]]..deskripsi:gsub("\n", "\\n")..[[",
                    "color": "]] .. math.random(0, 16777215) .. [[",
                    "footer": {
                        "text": "]]..(os.date("!%a %b %d, %Y at %I:%M %p", os.time() + 7 * 60 * 60))..[[",
                        "icon_url": "https://share.creavite.co/9ugoY1REemeb0nVZ.gif"
                    },
                    "thumbnail": {
                        "url": "https://cdn.discordapp.com/icons/1083626271038263357/8e34c12fcd52fa363eeb14c2e401a26b.png?size=4096"
                    }
                }
            ]
        }
        ]]

    x = httpReq(RequestINFO)
if not x.success then
log(x.failInfo)
end
end

function main()
while true do
::KIRANA::
botshow("Taking Fossil..")
if scanFossil() == 0 then
getBot():reConnect()
sleep(8000)
reconnect()
waktu[worldss[startFrom]] = totalfossil
botshow("World Finish")
SaveFossil()
NextWorld()
goto KIRANA
end
for _, tile in ipairs(getBot():getTiles()) do
if tile.fg == 3918 then
getBot():findPath(tile.x,tile.y-1)
sleep(8000)
end
end
 find_extracted = true
    getBot():autoCollect(4,false)
    while getBot():getTile(math.floor(getBot():getLocal().pos.x / 32),math.floor(getBot():getLocal().pos.y / 32) + 1).fg == 3918 do
        while find_extracted and not getBot():isEquipped(3932) do
            wear(3932)
            sleep(1000)
        end
        a = 1
        while find_extracted do
            punch(0,1)
            a = a + 1
            sleep(1000)
        if getBot():getTile(math.floor(getBot():getLocal().pos.x / 32), math.floor(getBot():getLocal().pos.y /32 + 1)).fg ~= 3918 then
       find_extracted = false
       break
       end
            if a > 25 then
                sleep(6000)
                a = 1
            end
        end
        while fossil_rock and not getBot():isEquipped(3934) do
            wear(3934)
            sleep(1000)
        end
        while fossil_rock do
            punch(0,1)
            sleep(160)
            if getBot():getTile(math.floor(getBot():getLocal().pos.x / 32),math.floor(getBot():getLocal().pos.y / 32) + 1).fg ~= 3918 then
                fossil_rock = false
            end
        end
        sleep(500)
    end
    sleep(2000)
    if UseFossilBrush then
    place(4132, 0, 1)
    sleep(1500)
    end
    getBot():autoCollect(4,true)
    sleep(1000)
    getBot():autoCollect(4,false)
    start_fossil = start_fossil + 1
    totalfossil = totalfossil + 1
if AutoPutRock then
while getBot():getTile(math.floor(getBot():getLocal().pos.x /32), math.floor(getBot():getLocal().pos.y /32 + 1)).fg ~= 10 do
sleep(1000)
place(10, 0, 1)
sleep(700)
end
end
if scanFossil() == 0 then
getBot():reConnect()
sleep(8000)
reconnect()
waktu[worldss[startFrom]] = totalfossil
totalfossil = 0
botshow("World Finish")
SaveFossil()
NextWorld()
end
end
end

find_extracted = true
fossil_rock = false

function checkdata()
  RequestINFO2 = {}
  RequestINFO2.url = "https://rentry.org/kitamahkeren/raw"
  y = httpReq(RequestINFO2)

if y.success then
if string.find(y.body, OwnerName) then
checknya = true
return
else
log("OwnerName Not Found , Please Use Command First Then Run The Script")
return
end
else
log("Cant Open Database, Please Try Use Vpn To Run Script")
return
end
end

function mulai()
if not checknya then
checkdata()
end
if checknya then
::ANJAY::
warp(worlds[startFrom], DoorID)
if nuked then
waktu[worlds[startFrom]] = "NUKED"
startFrom=startFrom+1
botshow("Nuked")
nuked = false
goto ANJAY
end
if steal then
waktu[worlds[startFrom]] = "GOT STEAL"
startFrom=startFrom+1
botshow("World Got Steal, Cant Go To DoorID, Please Check It")
steal = false
goto ANJAY
end
main()
end
end

mulai()
while true do
sleep(1)
end
